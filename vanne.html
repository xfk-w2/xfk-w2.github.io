<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Vanne</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #ffeef2;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Dancing Script', cursive;
        }

        #overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #ffeef2;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease;
        }

        #startBtn {
            padding: 15px 30px;
            font-size: 1.5rem;
            background: #d81b60;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Dancing Script', cursive;
            box-shadow: 0 4px 15px rgba(216, 27, 96, 0.4);
        }

        .title {
            text-align: center;
            color: #d81b60;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
            margin-bottom: 20px;
            animation: fadeInDown 1.5s ease-out forwards;
            padding: 0 20px;
            font-size: 2.5rem; /* Tama침o PC */
        }

        @media (max-width: 600px) {
            .title {
                font-size: 1.4rem; /* Tama침o optimizado celular */
            }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #canvas1 {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <p style="margin-bottom: 20px; color: #d81b60; font-size: 1.2rem;">Toca el coraz칩n para empezar</p>
        <button id="startBtn">仇벒잺</button>
    </div>

    <audio id="miMusica" loop>
        <source src="./Rauw Alejandro, LATIN MAFIA - 2_12 AM (Official Lyric Video) [i1HPgndDpVQ].mp3" type="audio/mpeg">
        Tu navegador no soporta la reproducci칩n de audio.
    </audio>
    <!-- Mensaje para mostrar errores de reproducci칩n -->
    <p id="audioError" style="display:none;color:#9b1b3a;margin-top:12px;text-align:center;"></p>

    <h1 class="title">춰Eres el punto y aparte en mi historia, lo inesperado que <br> le dio sentido a cada p치gina!</h1>
    
    <canvas id="canvas1"></canvas>

    <script>
        const canvas = document.getElementById('canvas1');
        const ctx = canvas.getContext('2d');
        const audio = document.getElementById('miMusica');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('startBtn');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particleArray = [];
        const mouse = { x: null, y: null, radius: 70 };

        startBtn.addEventListener('click', async () => {
            // Intentamos reproducir y esperamos el resultado para manejar errores
            try {
                await audio.play();
                // reproducido OK: ocultar overlay
                overlay.style.opacity = '0';
                setTimeout(() => overlay.style.display = 'none', 1000);
                // Indicar visualmente que est치 sonando
                startBtn.textContent = '游꿧';
                const err = document.getElementById('audioError'); if (err) err.style.display = 'none';
            } catch (e) {
                console.error('No se pudo reproducir el audio:', e);
                const err = document.getElementById('audioError');
                if (err) { err.textContent = 'No se pudo reproducir el audio. Comprueba la ruta o el formato del archivo.'; err.style.display = 'block'; }
            }

            // Siempre inicializamos la animaci칩n aunque el audio falle
            init();
            animate();
        });

        window.addEventListener('mousemove', (e) => { mouse.x = e.x; mouse.y = e.y; });

        // Mostrar error si ocurre al cargar el recurso
        audio.addEventListener('error', (ev) => {
            console.error('Error al cargar el archivo de audio', ev);
            const err = document.getElementById('audioError');
            if (err) { err.textContent = 'Error al cargar el archivo de audio (archivo no encontrado o formato inv치lido).'; err.style.display = 'block'; }
        });
        window.addEventListener('touchstart', (e) => { 
            mouse.x = e.touches[0].clientX; 
            mouse.y = e.touches[0].clientY; 
        });

        class Particle {
            constructor(x, y) {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.baseX = x;
                this.baseY = y;
                this.size = Math.random() * 2 + 1.5;
                this.density = (Math.random() * 30) + 1;
            }

            draw() {
                ctx.fillStyle = '#ff4d6d';
                ctx.beginPath();
                const x = this.x, y = this.y, s = this.size;
                ctx.moveTo(x, y);
                ctx.bezierCurveTo(x, y - s, x - s, y - s, x - s, y);
                ctx.bezierCurveTo(x - s, y + s, x, y + s, x, y + s * 1.5);
                ctx.bezierCurveTo(x, y + s, x + s, y + s, x + s, y);
                ctx.bezierCurveTo(x + s, y - s, x, y - s, x, y);
                ctx.fill();
            }

            update() {
                let dx = mouse.x - this.x;
                let dy = mouse.y - this.y;
                let distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < mouse.radius) {
                    this.x -= dx / 5;
                    this.y -= dy / 5;
                } else {
                    this.x -= (this.x - this.baseX) / 20;
                    this.y -= (this.y - this.baseY) / 20;
                }
            }
        }

        function init() {
            particleArray = [];
            const text = "VANNE";
            
            // Ajustamos el tama침o del 치rea de escaneo seg칰n el dispositivo
            const isMobile = window.innerWidth < 600;
            const fontSize = isMobile ? "18px" : "25px";
            const gap = isMobile ? 6 : 11; // Corazones m치s juntos en celular = palabra m치s peque침a
            
            ctx.fillStyle = 'white';
            ctx.font = `bold ${fontSize} Arial`;
            ctx.fillText(text, 0, 30); 
            
            const textWidth = ctx.measureText(text).width;
            const data = ctx.getImageData(0, 0, textWidth + 10, 50);
            
            // Centrado din치mico
            const offsetX = (canvas.width / 2) - (textWidth * gap / 2);
            const offsetY = (canvas.height / 2);

            for (let y = 0; y < data.height; y++) {
                for (let x = 0; x < data.width; x++) {
                    if (data.data[(y * 4 * data.width) + (x * 4) + 3] > 128) {
                        particleArray.push(new Particle(x * gap + offsetX, y * gap + offsetY));
                    }
                }
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particleArray.forEach(p => { p.draw(); p.update(); });
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            init();
        });
    </script>
</body>
</html>